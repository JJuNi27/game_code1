import random

# ì•„ì´í…œ í´ë˜ìŠ¤
class Item:
    def __init__(self, name, grade, attack_boost, health_boost):
        self.name = name
        self.grade = grade
        self.attack_boost = attack_boost
        self.health_boost = health_boost

    def __str__(self):
        return f"{self.name} ({self.grade})"

# í”Œë ˆì´ì–´ í´ë˜ìŠ¤
class Player:
    def __init__(self, name):
        self.name = name
        self.health = 100
        self.attack = 10
        self.coins = 50  # ì´ˆê¸° ì¬í™”
        self.items = []

    def buy_item(self, item):
        if self.coins >= 10:  # ì•„ì´í…œ ê°€ê²© 10ìœ¼ë¡œ ì„¤ì •
            self.coins -= 10
            self.items.append(item)
            print(f"{item.name}ë¥¼(ì„) êµ¬ë§¤í•˜ì˜€ìŠµë‹ˆë‹¤!")
        else:
            print("ì¬í™”ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.")

    def heal(self):
        heal_amount = 20
        self.health = min(100, self.health + heal_amount)
        print(f"ì²´ë ¥ì´ {heal_amount}ë§Œí¼ íšŒë³µë˜ì—ˆìŠµë‹ˆë‹¤. í˜„ì¬ ì²´ë ¥: {self.health}")

    def show_stats(self):
        print(f"\ní”Œë ˆì´ì–´ {self.name} ìƒíƒœ: ì²´ë ¥ {self.health} / ê³µê²©ë ¥ {self.attack} / ì¬í™” {self.coins}")

# ëª¬ìŠ¤í„° í´ë˜ìŠ¤
class Monster:
    def __init__(self, name, health, attack, grade):
        self.name = name
        self.health = health
        self.attack = attack
        self.grade = grade

    def show_stats(self):
        print(f"\n[ëª¬ìŠ¤í„°] {self.name} ({self.grade}) - ì²´ë ¥: {self.health}, ê³µê²©ë ¥: {self.attack}")

# ì œë ¨ì†Œ í´ë˜ìŠ¤ (ì•„ì´í…œ í•©ì„±)
class Refinery:
    def refine_items(self, grade):
        print(f"{grade} ë“±ê¸‰ ì•„ì´í…œ í•©ì„± ì¤‘...")
        if grade == "ë…¸ë§":
            return Item("ê°•í™”ëœ ë…¸ë§ ì•„ì´í…œ", "ì—í”½", 5, 5)
        elif grade == "ì—í”½":
            return Item("ê°•í™”ëœ ì—í”½ ì•„ì´í…œ", "ì „ì„¤", 10, 10)
        return None

# ì „íˆ¬ í•¨ìˆ˜
def battle(player, monster):
    while player.health > 0 and monster.health > 0:
        print(f"\ní”Œë ˆì´ì–´ ê³µê²©! ëª¬ìŠ¤í„° {monster.name} ì²´ë ¥: {monster.health}")
        monster.health -= player.attack
        if monster.health <= 0:
            print(f"ëª¬ìŠ¤í„° {monster.name}ë¥¼ ì²˜ì¹˜í–ˆìŠµë‹ˆë‹¤!")
            drop_item(player, monster)
            return True
        print(f"ëª¬ìŠ¤í„° ê³µê²©! í”Œë ˆì´ì–´ ì²´ë ¥: {player.health}")
        player.health -= monster.attack
    print("í”Œë ˆì´ì–´ê°€ íŒ¨ë°°í–ˆìŠµë‹ˆë‹¤!")
    return False

# ì•„ì´í…œ ë“œë í•¨ìˆ˜
def drop_item(player, monster):
    drop_chance = random.random()
    if monster.grade == "ì¼ë°˜" and drop_chance < 0.7:  # ì¼ë°˜ ëª¬ìŠ¤í„° 70% í™•ë¥ 
        item = random.choice(normal_items)
        print(f"ëª¬ìŠ¤í„°ê°€ {item.name}ë¥¼ ë“œëí–ˆìŠµë‹ˆë‹¤!")
        player.items.append(item)
    elif monster.grade == "ë ˆì–´" and drop_chance < 0.5:  # ë ˆì–´ ëª¬ìŠ¤í„° 50% í™•ë¥ 
        item = random.choice(epic_items)
        print(f"ëª¬ìŠ¤í„°ê°€ {item.name}ë¥¼ ë“œëí–ˆìŠµë‹ˆë‹¤!")
        player.items.append(item)
    elif monster.grade == "ë³´ìŠ¤" and drop_chance < 0.8:  # ë³´ìŠ¤ ëª¬ìŠ¤í„° 80% í™•ë¥ 
        item = random.choice(legendary_items)
        print(f"ëª¬ìŠ¤í„°ê°€ {item.name}ë¥¼ ë“œëí–ˆìŠµë‹ˆë‹¤!")
        player.items.append(item)
    else:
        print("ëª¬ìŠ¤í„°ê°€ ì•„ë¬´ê²ƒë„ ë“œëí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")

# ë˜ì „ íƒí—˜
def dungeon(player):
    refinery = Refinery()
    dungeon_rounds = 0  # ë˜ì „ íƒí—˜ íšŸìˆ˜ (ì´ˆë°˜ ëª¬ìŠ¤í„° ë“±ì¥ í™•ë¥ ì„ ì¡°ì •í•˜ê¸° ìœ„í•´ ì‚¬ìš©)
    
    while player.health > 0:
        print("\nğŸ” ë˜ì „ íƒí—˜ ì¤‘...")
        
        # ë˜ì „ íƒí—˜ íšŸìˆ˜ì— ë”°ë¼ ëª¬ìŠ¤í„° í™•ë¥  ë³€ê²½
        if dungeon_rounds < 5:  # ì´ˆë°˜ 5ë¼ìš´ë“œ
            monster_grade_probability = ["ì¼ë°˜"] * 7 + ["ë ˆì–´"] * 2 + ["ë³´ìŠ¤"] * 1
        elif dungeon_rounds < 10:  # ì¤‘ë°˜ 5~10ë¼ìš´ë“œ
            monster_grade_probability = ["ì¼ë°˜"] * 5 + ["ë ˆì–´"] * 3 + ["ë³´ìŠ¤"] * 2
        else:  # í›„ë°˜ 10ë¼ìš´ë“œ ì´í›„
            monster_grade_probability = ["ì¼ë°˜"] * 3 + ["ë ˆì–´"] * 4 + ["ë³´ìŠ¤"] * 3
        
        # ëª¬ìŠ¤í„° ë“±ê¸‰ì„ í™•ë¥ ì— ë§ê²Œ ëœë¤ìœ¼ë¡œ ì„ íƒ
        grade = random.choice(monster_grade_probability)

        event = random.choices(["monster", "shop", "rest", "trap", "refinery"], [0.5, 0.2, 0.2, 0.1, 0.1])[0]
        
        if event == "monster":
            monster_name = random.choice(["ì•…ëª½ì˜ ê´´ë¬¼", "ì§€ì˜¥ì˜ ì‚¬ì", "êµ¬ë¦„ì˜ ë§ˆì™•", "ë¶ˆì‚¬ì˜ ê´´ë¬¼", "ì–´ë‘ ì˜ ì§€ë°°ì"])
            
            # ì„ íƒí•œ ëª¬ìŠ¤í„° ë“±ê¸‰ì— ë”°ë¼ ëª¬ìŠ¤í„° ìƒì„±
            if grade == "ì¼ë°˜":
                monster = Monster(monster_name, health=30, attack=5, grade="ì¼ë°˜")
            elif grade == "ë ˆì–´":
                monster = Monster(monster_name, health=50, attack=10, grade="ë ˆì–´")
            else:  # ë³´ìŠ¤
                monster = Monster(monster_name, health=100, attack=20, grade="ë³´ìŠ¤")

            monster.show_stats()
            if not battle(player, monster):
                restart = input("ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n): ").lower()
                if restart == "y":
                    player.health = 100
                    continue
                else:
                    break
            
            # ë˜ì „ ë¼ìš´ë“œ ì§„í–‰
            dungeon_rounds += 1
        
        elif event == "shop":
            print("\nğŸ›’ ìƒì ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤!")
            shop_items = normal_items + epic_items + legendary_items
            print("ìƒì  ì•„ì´í…œ:", [item.name for item in shop_items])
            item_choice = input("ì•„ì´í…œì„ êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n): ").lower()
            if item_choice == "y":
                item = random.choice(shop_items)
                player.buy_item(item)
        elif event == "rest":
            print("\nğŸ’¤ ì‰¼í„°ì—ì„œ íœ´ì‹ì„ ì·¨í•©ë‹ˆë‹¤.")
            player.heal()
        elif event == "trap":
            print("\nâš ï¸ í•¨ì •ì— ë¹ ì¡ŒìŠµë‹ˆë‹¤! ì²´ë ¥ 20 ê°ì†Œ!")
            player.health -= 20
        elif event == "refinery":
            print("\nğŸ› ï¸ ì œë ¨ì†Œì— ë„ì°©í–ˆìŠµë‹ˆë‹¤. ì•„ì´í…œ í•©ì„±!")
            item_grade = input("í•©ì„±í•  ì•„ì´í…œ ë“±ê¸‰ì„ ì…ë ¥í•˜ì„¸ìš” (ë…¸ë§, ì—í”½, ì „ì„¤): ").lower()
            new_item = refinery.refine_items(item_grade.capitalize())
            if new_item:
                print(f"ì œë ¨ì†Œì—ì„œ í•©ì„±ëœ ì•„ì´í…œ: {new_item.name}")

# ì•„ì´í…œ ëª©ë¡
normal_items = [Item("ë…¸ë§ ê²€", "ë…¸ë§", 5, 0), Item("ë…¸ë§ ë°©íŒ¨", "ë…¸ë§", 0, 5)]
epic_items = [Item("ì—í”½ ê²€", "ì—í”½", 10, 0), Item("ì—í”½ ë°©íŒ¨", "ì—í”½", 0, 10)]
legendary_items = [Item("ì „ì„¤ ê²€", "ì „ì„¤", 20, 0), Item("ì „ì„¤ ë°©íŒ¨", "ì „ì„¤", 0, 20)]

# ê²Œì„ ì‹œì‘
def main():
    print("âš”ï¸ ë˜ì „ ëª¨í—˜ ê²Œì„ ì‹œì‘!")
    player_name = input("í”Œë ˆì´ì–´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”: ")
    player = Player(player_name)
    
    dungeon(player)  # ë˜ì „ íƒí—˜ ì‹œì‘

if __name__ == "__main__":
    main()
